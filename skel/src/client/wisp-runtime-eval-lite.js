(function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i})({1:[function(require,module,exports){var _ns_={id:"wisp.engine.browser"};var wisp_runtime=require("./../runtime");var str=wisp_runtime.str;var wisp_sequence=require("./../sequence");var rest=wisp_sequence.rest;var wisp_reader=require("./../reader");var read_=wisp_reader.read_;var readFromString=wisp_reader.readFromString;var wisp_compiler=require("./../compiler");var compile_=wisp_compiler.compile_;var evaluate=function evaluate(code,url){return eval(compile_(read_(code,url)))};exports.evaluate=evaluate;var run=function run(code,url){return Function(compile_(read_(code,url)))()};exports.run=run;var load=function load(url,callback){var request=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");request.open("GET",url,true);request.overrideMimeType?request.overrideMimeType("application/wisp"):void 0;request.onreadystatechange=function(){return request.readyState===4?request.status===0||request.status===200?callback(run(request.responseText,url)):callback("Could not load"):void 0};return request.send(null)};exports.load=load;var runScripts=function runScripts(){var scripts=Array.prototype.filter.call(document.getElementsByTagName("script"),function(script){return script.type==="application/wisp"});var next=function next(){return scripts.length?function(){var script=scripts.shift();return script.src?load(script.src,next):next(run(script.innerHTML))}():void 0};return next()};exports.runScripts=runScripts;document.readyState==="complete"||document.readyState==="interactive"?runScripts():window.addEventListener?window.addEventListener("DOMContentLoaded",runScripts,false):window.attachEvent("onload",runScripts)},{"./../runtime":2,"./../sequence":3,"./../reader":4,"./../compiler":5}],2:[function(require,module,exports){(function(){var _ns_={id:"wisp.runtime",doc:"Core primitives required for runtime"};var identity=function identity(x){return x};exports.identity=identity;var isOdd=function isOdd(n){return n%2===1};exports.isOdd=isOdd;var isEven=function isEven(n){return n%2===0};exports.isEven=isEven;var isDictionary=function isDictionary(form){return isObject(form)&&isObject(Object.getPrototypeOf(form))&&isNil(Object.getPrototypeOf(Object.getPrototypeOf(form)))};exports.isDictionary=isDictionary;var dictionary=function dictionary(){return function loop(keyValues,result){var recur=loop;while(recur===loop){recur=keyValues.length?function(){(result||0)[(keyValues||0)[0]]=(keyValues||0)[1];return keyValues=keyValues.slice(2),result=result,loop}():result}return recur}(Array.prototype.slice.call(arguments),{})};exports.dictionary=dictionary;var keys=function keys(dictionary){return Object.keys(dictionary)};exports.keys=keys;var vals=function vals(dictionary){return keys(dictionary).map(function(key){return(dictionary||0)[key]})};exports.vals=vals;var keyValues=function keyValues(dictionary){return keys(dictionary).map(function(key){return[key,(dictionary||0)[key]]})};exports.keyValues=keyValues;var merge=function merge(){return Object.create(Object.prototype,Array.prototype.slice.call(arguments).reduce(function(descriptor,dictionary){isObject(dictionary)?Object.keys(dictionary).forEach(function(key){return(descriptor||0)[key]=Object.getOwnPropertyDescriptor(dictionary,key)}):void 0;return descriptor},Object.create(Object.prototype)))};exports.merge=merge;var isContainsVector=function isContainsVector(vector,element){return vector.indexOf(element)>=0};exports.isContainsVector=isContainsVector;var mapDictionary=function mapDictionary(source,f){return Object.keys(source).reduce(function(target,key){(target||0)[key]=f((source||0)[key]);return target},{})};exports.mapDictionary=mapDictionary;var toString=Object.prototype.toString;exports.toString=toString;var isFn=typeof/./==="function"?function isFn(x){return toString.call(x)==="[object Function]"}:function isFn(x){return typeof x==="function"};exports.isFn=isFn;var isString=function isString(x){return typeof x==="string"||toString.call(x)==="[object String]"};exports.isString=isString;var isNumber=function isNumber(x){return typeof x==="number"||toString.call(x)==="[object Number]"};exports.isNumber=isNumber;var isVector=isFn(Array.isArray)?Array.isArray:function isVector(x){return toString.call(x)==="[object Array]"};exports.isVector=isVector;var isDate=function isDate(x){return toString.call(x)==="[object Date]"};exports.isDate=isDate;var isBoolean=function isBoolean(x){return x===true||x===false||toString.call(x)==="[object Boolean]"};exports.isBoolean=isBoolean;var isRePattern=function isRePattern(x){return toString.call(x)==="[object RegExp]"};exports.isRePattern=isRePattern;var isObject=function isObject(x){return x&&typeof x==="object"};exports.isObject=isObject;var isNil=function isNil(x){return x===void 0||x===null};exports.isNil=isNil;var isTrue=function isTrue(x){return x===true};exports.isTrue=isTrue;var isFalse=function isFalse(x){return x===true};exports.isFalse=isFalse;var reFind=function reFind(re,s){var matches=re.exec(s);return!isNil(matches)?matches.length===1?(matches||0)[0]:matches:void 0};exports.reFind=reFind;var reMatches=function reMatches(pattern,source){var matches=pattern.exec(source);return!isNil(matches)&&(matches||0)[0]===source?matches.length===1?(matches||0)[0]:matches:void 0};exports.reMatches=reMatches;var rePattern=function rePattern(s){var match=reFind(/^(?:\(\?([idmsux]*)\))?(.*)/,s);return new RegExp((match||0)[2],(match||0)[1])};exports.rePattern=rePattern;var inc=function inc(x){return x+1};exports.inc=inc;var dec=function dec(x){return x-1};exports.dec=dec;var str=function str(){return String.prototype.concat.apply("",arguments)};exports.str=str;var char=function char(code){return String.fromCharCode(code)};exports.char=char;var int=function int(x){return isNumber(x)?x>=0?Math.floor(x):Math.floor(x):x.charCodeAt(0)};exports.int=int;var subs=function subs(string,start,end){return string.substring(start,end)};exports.subs=subs;var isPatternEqual=function isPatternEqual(x,y){return isRePattern(x)&&isRePattern(y)&&x.source===y.source&&x.global===y.global&&x.multiline===y.multiline&&x.ignoreCase===y.ignoreCase};var isDateEqual=function isDateEqual(x,y){return isDate(x)&&isDate(y)&&Number(x)===Number(y)};var isDictionaryEqual=function isDictionaryEqual(x,y){return isObject(x)&&isObject(y)&&function(){var xKeys=keys(x);var yKeys=keys(y);var xCount=xKeys.length;var yCount=yKeys.length;return xCount===yCount&&function loop(index,count,keys){var recur=loop;while(recur===loop){recur=index<count?isEquivalent((x||0)[(keys||0)[index]],(y||0)[(keys||0)[index]])?(index=inc(index),count=count,keys=keys,loop):false:true}return recur}(0,xCount,xKeys)}()};var isVectorEqual=function isVectorEqual(x,y){return isVector(x)&&isVector(y)&&x.length===y.length&&function loop(xs,ys,index,count){var recur=loop;while(recur===loop){recur=index<count?isEquivalent((xs||0)[index],(ys||0)[index])?(xs=xs,ys=ys,index=inc(index),count=count,loop):false:true}return recur}(x,y,0,x.length)};var isEquivalent=function isEquivalent(x,y){switch(arguments.length){case 1:return true;case 2:return x===y||(isNil(x)?isNil(y):isNil(y)?isNil(x):isString(x)?false:isNumber(x)?false:isFn(x)?false:isBoolean(x)?false:isDate(x)?isDateEqual(x,y):isVector(x)?isVectorEqual(x,y,[],[]):isRePattern(x)?isPatternEqual(x,y):"else"?isDictionaryEqual(x,y):void 0);default:var more=Array.prototype.slice.call(arguments,2);return function loop(previous,current,index,count){var recur=loop;while(recur===loop){recur=isEquivalent(previous,current)&&(index<count?(previous=current,current=(more||0)[index],index=inc(index),count=count,loop):true)}return recur}(x,y,0,more.length)}return void 0};var isEqual=isEquivalent;exports.isEqual=isEqual;var isStrictEqual=function isStrictEqual(x,y){switch(arguments.length){case 1:return true;case 2:return x===y;default:var more=Array.prototype.slice.call(arguments,2);return function loop(previous,current,index,count){var recur=loop;while(recur===loop){recur=previous===current&&(index<count?(previous=current,current=(more||0)[index],index=inc(index),count=count,loop):true)}return recur}(x,y,0,more.length)}return void 0};exports.isStrictEqual=isStrictEqual;var greaterThan=function greaterThan(x,y){switch(arguments.length){case 1:return true;case 2:return x>y;default:var more=Array.prototype.slice.call(arguments,2);return function loop(previous,current,index,count){var recur=loop;while(recur===loop){recur=previous>current&&(index<count?(previous=current,current=(more||0)[index],index=inc(index),count=count,loop):true)}return recur}(x,y,0,more.length)}return void 0};exports.greaterThan=greaterThan;var notLessThan=function notLessThan(x,y){switch(arguments.length){case 1:return true;case 2:return x>=y;default:var more=Array.prototype.slice.call(arguments,2);return function loop(previous,current,index,count){var recur=loop;while(recur===loop){recur=previous>=current&&(index<count?(previous=current,current=(more||0)[index],index=inc(index),count=count,loop):true)}return recur}(x,y,0,more.length)}return void 0};exports.notLessThan=notLessThan;var lessThan=function lessThan(x,y){switch(arguments.length){case 1:return true;case 2:return x<y;default:var more=Array.prototype.slice.call(arguments,2);return function loop(previous,current,index,count){var recur=loop;while(recur===loop){recur=previous<current&&(index<count?(previous=current,current=(more||0)[index],index=inc(index),count=count,loop):true)}return recur}(x,y,0,more.length)}return void 0};exports.lessThan=lessThan;var notGreaterThan=function notGreaterThan(x,y){switch(arguments.length){case 1:return true;case 2:return x<=y;default:var more=Array.prototype.slice.call(arguments,2);return function loop(previous,current,index,count){var recur=loop;while(recur===loop){recur=previous<=current&&(index<count?(previous=current,current=(more||0)[index],index=inc(index),count=count,loop):true)}return recur}(x,y,0,more.length)}return void 0};exports.notGreaterThan=notGreaterThan;var sum=function sum(a,b,c,d,e,f){switch(arguments.length){case 0:return 0;case 1:return a;case 2:return a+b;case 3:return a+b+c;case 4:return a+b+c+d;case 5:return a+b+c+d+e;case 6:return a+b+c+d+e+f;default:var more=Array.prototype.slice.call(arguments,6);return function loop(value,index,count){var recur=loop;while(recur===loop){recur=index<count?(value=value+(more||0)[index],index=inc(index),count=count,loop):value}return recur}(a+b+c+d+e+f,0,more.length)}return void 0};exports.sum=sum;var subtract=function subtract(a,b,c,d,e,f){switch(arguments.length){case 0:return function(){throw TypeError("Wrong number of args passed to: -")}();case 1:return 0-a;case 2:return a-b;case 3:return a-b-c;case 4:return a-b-c-d;case 5:return a-b-c-d-e;case 6:return a-b-c-d-e-f;default:var more=Array.prototype.slice.call(arguments,6);return function loop(value,index,count){var recur=loop;while(recur===loop){recur=index<count?(value=value-(more||0)[index],index=inc(index),count=count,loop):value}return recur}(a-b-c-d-e-f,0,more.length)}return void 0};exports.subtract=subtract;var divide=function divide(a,b,c,d,e,f){switch(arguments.length){case 0:return function(){throw TypeError("Wrong number of args passed to: /")}();case 1:return 1/a;case 2:return a/b;case 3:return a/b/c;case 4:return a/b/c/d;case 5:return a/b/c/d/e;case 6:return a/b/c/d/e/f;default:var more=Array.prototype.slice.call(arguments,6);return function loop(value,index,count){var recur=loop;while(recur===loop){recur=index<count?(value=value/(more||0)[index],index=inc(index),count=count,loop):value}return recur}(a/b/c/d/e/f,0,more.length)}return void 0};exports.divide=divide;var multiply=function multiply(a,b,c,d,e,f){switch(arguments.length){case 0:return 1;case 1:return a;case 2:return a*b;case 3:return a*b*c;case 4:return a*b*c*d;case 5:return a*b*c*d*e;case 6:return a*b*c*d*e*f;default:var more=Array.prototype.slice.call(arguments,6);return function loop(value,index,count){var recur=loop;while(recur===loop){recur=index<count?(value=value*(more||0)[index],index=inc(index),count=count,loop):value}return recur}(a*b*c*d*e*f,0,more.length)}return void 0};exports.multiply=multiply;var and=function and(a,b,c,d,e,f){switch(arguments.length){case 0:return true;case 1:return a;case 2:return a&&b;case 3:return a&&b&&c;case 4:return a&&b&&c&&d;case 5:return a&&b&&c&&d&&e;case 6:return a&&b&&c&&d&&e&&f;default:var more=Array.prototype.slice.call(arguments,6);return function loop(value,index,count){var recur=loop;while(recur===loop){recur=index<count?(value=value&&(more||0)[index],index=inc(index),count=count,loop):value}return recur}(a&&b&&c&&d&&e&&f,0,more.length)}return void 0};exports.and=and;var or=function or(a,b,c,d,e,f){switch(arguments.length){case 0:return void 0;case 1:return a;case 2:return a||b;case 3:return a||b||c;case 4:return a||b||c||d;case 5:return a||b||c||d||e;case 6:return a||b||c||d||e||f;default:var more=Array.prototype.slice.call(arguments,6);return function loop(value,index,count){var recur=loop;while(recur===loop){recur=index<count?(value=value||(more||0)[index],index=inc(index),count=count,loop):value}return recur}(a||b||c||d||e||f,0,more.length)}return void 0};exports.or=or;var print=function print(){var more=Array.prototype.slice.call(arguments,0);return console.log.apply(console.log,more)};exports.print=print})()},{}],3:[function(require,module,exports){var _ns_={id:"wisp.sequence"};var wisp_runtime=require("./runtime");var isNil=wisp_runtime.isNil;var isVector=wisp_runtime.isVector;var isFn=wisp_runtime.isFn;var isNumber=wisp_runtime.isNumber;var isString=wisp_runtime.isString;var isDictionary=wisp_runtime.isDictionary;var keyValues=wisp_runtime.keyValues;var str=wisp_runtime.str;var dec=wisp_runtime.dec;var inc=wisp_runtime.inc;var merge=wisp_runtime.merge;var dictionary=wisp_runtime.dictionary;var List=function List(head,tail){this.head=head;this.tail=tail||list();this.length=inc(count(this.tail));return this};List.prototype.length=0;List.type="wisp.list";List.prototype.type=List.type;List.prototype.tail=Object.create(List.prototype);List.prototype.toString=function(){return function loop(result,list){var recur=loop;while(recur===loop){recur=isEmpty(list)?""+"("+result.substr(1)+")":(result=""+result+" "+(isVector(first(list))?""+"["+first(list).join(" ")+"]":isNil(first(list))?"nil":isString(first(list))?JSON.stringify(first(list)):isNumber(first(list))?JSON.stringify(first(list)):first(list)),list=rest(list),loop)}return recur}("",this)};var lazySeqValue=function lazySeqValue(lazySeq){return!lazySeq.realized?(lazySeq.realized=true)&&(lazySeq.x=lazySeq.x()):lazySeq.x};var LazySeq=function LazySeq(realized,x){this.realized=realized||false;this.x=x;return this};LazySeq.type="wisp.lazy.seq";LazySeq.prototype.type=LazySeq.type;var lazySeq=function lazySeq(realized,body){return new LazySeq(realized,body)};exports.lazySeq=lazySeq;var isLazySeq=function isLazySeq(value){return value&&LazySeq.type===value.type};exports.isLazySeq=isLazySeq;undefined;var isList=function isList(value){return value&&List.type===value.type};exports.isList=isList;var list=function list(){return arguments.length===0?Object.create(List.prototype):Array.prototype.slice.call(arguments).reduceRight(function(tail,head){return cons(head,tail)},list())};exports.list=list;var cons=function cons(head,tail){return new List(head,tail)};exports.cons=cons;var reverseList=function reverseList(sequence){return function loop(items,source){var recur=loop;while(recur===loop){recur=isEmpty(source)?list.apply(list,items):(items=[first(source)].concat(items),source=rest(source),loop)}return recur}([],sequence)};var isSequential=function isSequential(x){return isList(x)||isVector(x)||isLazySeq(x)||isDictionary(x)||isString(x)};exports.isSequential=isSequential;var reverse=function reverse(sequence){return isList(sequence)?reverseList(sequence):isVector(sequence)?sequence.reverse():isNil(sequence)?list():"else"?reverse(seq(sequence)):void 0};exports.reverse=reverse;var map=function map(f,sequence){return isVector(sequence)?sequence.map(f):isList(sequence)?mapList(f,sequence):isNil(sequence)?list():"else"?map(f,seq(sequence)):void 0};exports.map=map;var mapList=function mapList(f,sequence){return function loop(result,items){var recur=loop;while(recur===loop){recur=isEmpty(items)?reverse(result):(result=cons(f(first(items)),result),items=rest(items),loop)}return recur}(list(),sequence)};var filter=function filter(isF,sequence){return isVector(sequence)?sequence.filter(isF):isList(sequence)?filterList(isF,sequence):isNil(sequence)?list():"else"?filter(isF,seq(sequence)):void 0};exports.filter=filter;var filterList=function filterList(isF,sequence){return function loop(result,items){var recur=loop;while(recur===loop){recur=isEmpty(items)?reverse(result):(result=isF(first(items))?cons(first(items),result):result,items=rest(items),loop)}return recur}(list(),sequence)};var reduce=function reduce(f){var params=Array.prototype.slice.call(arguments,1);return function(){var hasInitial=count(params)>=2;var initial=hasInitial?first(params):void 0;var sequence=hasInitial?second(params):first(params);return isNil(sequence)?initial:isVector(sequence)?hasInitial?sequence.reduce(f,initial):sequence.reduce(f):isList(sequence)?hasInitial?reduceList(f,initial,sequence):reduceList(f,first(sequence),rest(sequence)):"else"?reduce(f,initial,seq(sequence)):void 0}()};exports.reduce=reduce;var reduceList=function reduceList(f,initial,sequence){return function loop(result,items){var recur=loop;while(recur===loop){recur=isEmpty(items)?result:(result=f(result,first(items)),items=rest(items),loop)}return recur}(initial,sequence)};var count=function count(sequence){return isNil(sequence)?0:seq(sequence).length};exports.count=count;var isEmpty=function isEmpty(sequence){return count(sequence)===0};exports.isEmpty=isEmpty;var first=function first(sequence){return isNil(sequence)?void 0:isList(sequence)?sequence.head:isVector(sequence)||isString(sequence)?(sequence||0)[0]:isLazySeq(sequence)?first(lazySeqValue(sequence)):"else"?first(seq(sequence)):void 0};exports.first=first;var second=function second(sequence){return isNil(sequence)?void 0:isList(sequence)?first(rest(sequence)):isVector(sequence)||isString(sequence)?(sequence||0)[1]:isLazySeq(sequence)?second(lazySeqValue(sequence)):"else"?first(rest(seq(sequence))):void 0};exports.second=second;var third=function third(sequence){return isNil(sequence)?void 0:isList(sequence)?first(rest(rest(sequence))):isVector(sequence)||isString(sequence)?(sequence||0)[2]:isLazySeq(sequence)?third(lazySeqValue(sequence)):"else"?second(rest(seq(sequence))):void 0};exports.third=third;var rest=function rest(sequence){return isNil(sequence)?list():isList(sequence)?sequence.tail:isVector(sequence)||isString(sequence)?sequence.slice(1):isLazySeq(sequence)?rest(lazySeqValue(sequence)):"else"?rest(seq(sequence)):void 0};exports.rest=rest;var lastOfList=function lastOfList(list){return function loop(item,items){var recur=loop;while(recur===loop){recur=isEmpty(items)?item:(item=first(items),items=rest(items),loop)}return recur}(first(list),rest(list))};var last=function last(sequence){return isVector(sequence)||isString(sequence)?(sequence||0)[dec(count(sequence))]:isList(sequence)?lastOfList(sequence):isNil(sequence)?void 0:isLazySeq(sequence)?last(lazySeqValue(sequence)):"else"?last(seq(sequence)):void 0};exports.last=last;var butlast=function butlast(sequence){var items=isNil(sequence)?void 0:isString(sequence)?subs(sequence,0,dec(count(sequence))):isVector(sequence)?sequence.slice(0,dec(count(sequence))):isList(sequence)?list.apply(list,butlast(vec(sequence))):isLazySeq(sequence)?butlast(lazySeqValue(sequence)):"else"?butlast(seq(sequence)):void 0;return!(isNil(items)||isEmpty(items))?items:void 0};exports.butlast=butlast;var take=function take(n,sequence){return isNil(sequence)?list():isVector(sequence)?takeFromVector(n,sequence):isList(sequence)?takeFromList(n,sequence):isLazySeq(sequence)?take(n,lazySeqValue(sequence)):"else"?take(n,seq(sequence)):void 0};exports.take=take;var takeVectorWhile=function takeVectorWhile(predicate,vector){return function loop(result,tail,head){var recur=loop;while(recur===loop){recur=!isEmpty(tail)&&predicate(head)?(result=conj(result,head),tail=rest(tail),head=first(tail),loop):result}return recur}([],vector,first(vector))};var takeListWhile=function takeListWhile(predicate,items){return function loop(result,tail,head){var recur=loop;while(recur===loop){recur=!isEmpty(tail)&&isPredicate(head)?(result=conj(result,head),tail=rest(tail),head=first(tail),loop):list.apply(list,result)}return recur}([],items,first(items))};var takeWhile=function takeWhile(predicate,sequence){return isNil(sequence)?list():isVector(sequence)?takeVectorWhile(predicate,sequence):isList(sequence)?takeVectorWhile(predicate,sequence):"else"?takeWhile(predicate,lazySeqValue(sequence)):void 0};exports.takeWhile=takeWhile;var takeFromVector=function takeFromVector(n,vector){return vector.slice(0,n)};var takeFromList=function takeFromList(n,sequence){return function loop(taken,items,n){var recur=loop;while(recur===loop){recur=n===0||isEmpty(items)?reverse(taken):(taken=cons(first(items),taken),items=rest(items),n=dec(n),loop)}return recur}(list(),sequence,n)};var dropFromList=function dropFromList(n,sequence){return function loop(left,items){var recur=loop;while(recur===loop){recur=left<1||isEmpty(items)?items:(left=dec(left),items=rest(items),loop)}return recur}(n,sequence)};var drop=function drop(n,sequence){return n<=0?sequence:isString(sequence)?sequence.substr(n):isVector(sequence)?sequence.slice(n):isList(sequence)?dropFromList(n,sequence):isNil(sequence)?list():isLazySeq(sequence)?drop(n,lazySeqValue(sequence)):"else"?drop(n,seq(sequence)):void 0};exports.drop=drop;var conjList=function conjList(sequence,items){return reduce(function(result,item){return cons(item,result)},sequence,items)};var conj=function conj(sequence){var items=Array.prototype.slice.call(arguments,1);return isVector(sequence)?sequence.concat(items):isString(sequence)?""+sequence+str.apply(str,items):isNil(sequence)?list.apply(list,reverse(items)):isList(sequence)||isLazySeq()?conjList(sequence,items):isDictionary(sequence)?merge(sequence,merge.apply(merge,items)):"else"?function(){throw TypeError(""+"Type can't be conjoined "+sequence)}():void 0};exports.conj=conj;var assoc=function assoc(source){var keyValues=Array.prototype.slice.call(arguments,1);return conj(source,dictionary.apply(dictionary,keyValues))};exports.assoc=assoc;var concat=function concat(){var sequences=Array.prototype.slice.call(arguments,0);return reverse(reduce(function(result,sequence){return reduce(function(result,item){return cons(item,result)},result,seq(sequence))},list(),sequences))};exports.concat=concat;var seq=function seq(sequence){return isNil(sequence)?void 0:isVector(sequence)||isList(sequence)||isLazySeq(sequence)?sequence:isString(sequence)?Array.prototype.slice.call(sequence):isDictionary(sequence)?keyValues(sequence):"default"?function(){throw TypeError(""+"Can not seq "+sequence)}():void 0};exports.seq=seq;var isSeq=function isSeq(sequence){return isList(sequence)||isLazySeq(sequence)};exports.isSeq=isSeq;var listToVector=function listToVector(source){return function loop(result,list){var recur=loop;while(recur===loop){recur=isEmpty(list)?result:(result=function(){result.push(first(list));return result}(),list=rest(list),loop)}return recur}([],source)};var vec=function vec(sequence){return isNil(sequence)?[]:isVector(sequence)?sequence:isList(sequence)?listToVector(sequence):"else"?vec(seq(sequence)):void 0};exports.vec=vec;var sort=function sort(f,items){var hasComparator=isFn(f);var items=!hasComparator&&isNil(items)?f:items;var compare=hasComparator?function(a,b){return f(a,b)?0:1}:void 0;return isNil(items)?list():isVector(items)?items.sort(compare):isList(items)?list.apply(list,vec(items).sort(compare)):isDictionary(items)?seq(items).sort(compare):"else"?sort(f,seq(items)):void 0};exports.sort=sort;var repeat=function repeat(n,x){return function loop(n,result){var recur=loop;while(recur===loop){recur=n<=0?result:(n=dec(n),result=conj(result,x),loop)}return recur}(n,[])};exports.repeat=repeat},{"./runtime":2}],4:[function(require,module,exports){var _ns_={id:"wisp.reader",doc:"Reader module provides functions for reading text input\n  as wisp data structures"};var wisp_sequence=require("./sequence");var list=wisp_sequence.list;var isList=wisp_sequence.isList;var count=wisp_sequence.count;var isEmpty=wisp_sequence.isEmpty;var first=wisp_sequence.first;var second=wisp_sequence.second;var third=wisp_sequence.third;var rest=wisp_sequence.rest;var map=wisp_sequence.map;var vec=wisp_sequence.vec;var cons=wisp_sequence.cons;var conj=wisp_sequence.conj;var concat=wisp_sequence.concat;var last=wisp_sequence.last;var butlast=wisp_sequence.butlast;var sort=wisp_sequence.sort;var lazySeq=wisp_sequence.lazySeq;var wisp_runtime=require("./runtime");var isOdd=wisp_runtime.isOdd;var dictionary=wisp_runtime.dictionary;var keys=wisp_runtime.keys;var isNil=wisp_runtime.isNil;var inc=wisp_runtime.inc;var dec=wisp_runtime.dec;var isVector=wisp_runtime.isVector;var isString=wisp_runtime.isString;var isNumber=wisp_runtime.isNumber;var isBoolean=wisp_runtime.isBoolean;var isObject=wisp_runtime.isObject;var isDictionary=wisp_runtime.isDictionary;var rePattern=wisp_runtime.rePattern;var reMatches=wisp_runtime.reMatches;var reFind=wisp_runtime.reFind;var str=wisp_runtime.str;var subs=wisp_runtime.subs;var char=wisp_runtime.char;var vals=wisp_runtime.vals;var isEqual=wisp_runtime.isEqual;var wisp_ast=require("./ast");var isSymbol=wisp_ast.isSymbol;var symbol=wisp_ast.symbol;var isKeyword=wisp_ast.isKeyword;var keyword=wisp_ast.keyword;var meta=wisp_ast.meta;var withMeta=wisp_ast.withMeta;var name=wisp_ast.name;var gensym=wisp_ast.gensym;var wisp_string=require("./string");var split=wisp_string.split;var join=wisp_string.join;var pushBackReader=function pushBackReader(source,uri){return{lines:split(source,"\n"),buffer:"",uri:uri,column:-1,line:0}};exports.pushBackReader=pushBackReader;var peekChar=function peekChar(reader){var line=(reader||0)["lines"][(reader||0)["line"]];var column=inc((reader||0)["column"]);return isNil(line)?void 0:line[column]||"\n"};exports.peekChar=peekChar;var readChar=function readChar(reader){var ch=peekChar(reader);isNewline(peekChar(reader))?function(){(reader||0)["line"]=inc((reader||0)["line"]);return(reader||0)["column"]=-1}():(reader||0)["column"]=inc((reader||0)["column"]);return ch};exports.readChar=readChar;var isNewline=function isNewline(ch){return"\n"===ch};exports.isNewline=isNewline;var isBreakingWhitespace=function isBreakingWhitespace(ch){return ch===" "||ch==="	"||ch==="\n"||ch==="\r"};exports.isBreakingWhitespace=isBreakingWhitespace;var isWhitespace=function isWhitespace(ch){return isBreakingWhitespace(ch)||","===ch};exports.isWhitespace=isWhitespace;var isNumeric=function isNumeric(ch){return ch==="0"||ch==="1"||ch==="2"||ch==="3"||ch==="4"||ch==="5"||ch==="6"||ch==="7"||ch==="8"||ch==="9"};exports.isNumeric=isNumeric;var isCommentPrefix=function isCommentPrefix(ch){return";"===ch};exports.isCommentPrefix=isCommentPrefix;var isNumberLiteral=function isNumberLiteral(reader,initch){return isNumeric(initch)||("+"===initch||"-"===initch)&&isNumeric(peekChar(reader))};exports.isNumberLiteral=isNumberLiteral;var readerError=function readerError(reader,message){var text=""+message+"\n"+"line:"+(reader||0)["line"]+"\n"+"column:"+(reader||0)["column"];var error=SyntaxError(text,(reader||0)["uri"]);error.line=(reader||0)["line"];error.column=(reader||0)["column"];error.uri=(reader||0)["uri"];return function(){throw error}()};exports.readerError=readerError;var isMacroTerminating=function isMacroTerminating(ch){return!(ch==="#")&&!(ch==="'")&&!(ch===":")&&macros(ch)};exports.isMacroTerminating=isMacroTerminating;var readToken=function readToken(reader,initch){return function loop(buffer,ch){var recur=loop;while(recur===loop){recur=isNil(ch)||isWhitespace(ch)||isMacroTerminating(ch)?buffer:(buffer=""+buffer+readChar(reader),ch=peekChar(reader),loop)}return recur}(initch,peekChar(reader))};exports.readToken=readToken;var skipLine=function skipLine(reader,_){return function loop(){var recur=loop;while(recur===loop){recur=function(){var ch=readChar(reader);return ch==="\n"||ch==="\r"||isNil(ch)?reader:loop}()}return recur}()};exports.skipLine=skipLine;var intPattern=rePattern("^([-+]?)(?:(0)|([1-9][0-9]*)|0[xX]([0-9A-Fa-f]+)|0([0-7]+)|([1-9][0-9]?)[rR]([0-9A-Za-z]+)|0[0-9]+)(N)?$");exports.intPattern=intPattern;var ratioPattern=rePattern("([-+]?[0-9]+)/([0-9]+)");exports.ratioPattern=ratioPattern;var floatPattern=rePattern("([-+]?[0-9]+(\\.[0-9]*)?([eE][-+]?[0-9]+)?)(M)?");exports.floatPattern=floatPattern;var matchInt=function matchInt(s){var groups=reFind(intPattern,s);var group3=groups[2];return!(isNil(group3)||count(group3)<1)?0:function(){var negate="-"===groups[1]?-1:1;var a=groups[3]?[groups[3],10]:groups[4]?[groups[4],16]:groups[5]?[groups[5],8]:groups[7]?[groups[7],parseInt(groups[7])]:"else"?[void 0,void 0]:void 0;var n=a[0];var radix=a[1];return isNil(n)?void 0:negate*parseInt(n,radix)}()};exports.matchInt=matchInt;var matchRatio=function matchRatio(s){var groups=reFind(ratioPattern,s);var numinator=groups[1];var denominator=groups[2];return parseInt(numinator)/parseInt(denominator)};exports.matchRatio=matchRatio;var matchFloat=function matchFloat(s){return parseFloat(s)};exports.matchFloat=matchFloat;var matchNumber=function matchNumber(s){return reMatches(intPattern,s)?matchInt(s):reMatches(ratioPattern,s)?matchRatio(s):reMatches(floatPattern,s)?matchFloat(s):void 0};exports.matchNumber=matchNumber;var escapeCharMap=function escapeCharMap(c){return c==="t"?"	":c==="r"?"\r":c==="n"?"\n":c==="\\"?"\\":c==='"'?'"':c==="b"?"\b":c==="f"?"\f":"else"?void 0:void 0};exports.escapeCharMap=escapeCharMap;var read2Chars=function read2Chars(reader){return""+readChar(reader)+readChar(reader)};exports.read2Chars=read2Chars;var read4Chars=function read4Chars(reader){return""+readChar(reader)+readChar(reader)+readChar(reader)+readChar(reader)};exports.read4Chars=read4Chars;var unicode2Pattern=rePattern("[0-9A-Fa-f]{2}");exports.unicode2Pattern=unicode2Pattern;var unicode4Pattern=rePattern("[0-9A-Fa-f]{4}");exports.unicode4Pattern=unicode4Pattern;var validateUnicodeEscape=function validateUnicodeEscape(unicodePattern,reader,escapeChar,unicodeStr){return reMatches(unicodePattern,unicodeStr)?unicodeStr:readerError(reader,""+"Unexpected unicode escape "+"\\"+escapeChar+unicodeStr)};exports.validateUnicodeEscape=validateUnicodeEscape;var makeUnicodeChar=function makeUnicodeChar(codeStr,base){var base=base||16;var code=parseInt(codeStr,base);return char(code)};exports.makeUnicodeChar=makeUnicodeChar;var escapeChar=function escapeChar(buffer,reader){var ch=readChar(reader);var mapresult=escapeCharMap(ch);return mapresult?mapresult:ch==="x"?makeUnicodeChar(validateUnicodeEscape(unicode2Pattern,reader,ch,read2Chars(reader))):ch==="u"?makeUnicodeChar(validateUnicodeEscape(unicode4Pattern,reader,ch,read4Chars(reader))):isNumeric(ch)?char(ch):"else"?readerError(reader,""+"Unexpected unicode escape "+"\\"+ch):void 0};exports.escapeChar=escapeChar;var readPast=function readPast(predicate,reader){return function loop(_){var recur=loop;while(recur===loop){recur=predicate(peekChar(reader))?(_=readChar(reader),loop):peekChar(reader)}return recur}(void 0)};exports.readPast=readPast;var readDelimitedList=function readDelimitedList(delim,reader,isRecursive){return function loop(form){var recur=loop;
while(recur===loop){recur=function(){var ch=readPast(isWhitespace,reader);!ch?readerError(reader,"EOF"):void 0;return delim===ch?function(){readChar(reader);return form}():function(){var macro=macros(ch);return macro?function(){var result=macro(reader,readChar(reader));return form=result===reader?form:conj(form,result),loop}():function(){var o=read(reader,true,void 0,isRecursive);return form=o===reader?form:conj(form,o),loop}()}()}()}return recur}([])};exports.readDelimitedList=readDelimitedList;var notImplemented=function notImplemented(reader,ch){return readerError(reader,""+"Reader for "+ch+" not implemented yet")};exports.notImplemented=notImplemented;var readDispatch=function readDispatch(reader,_){var ch=readChar(reader);var dm=dispatchMacros(ch);return dm?dm(reader,_):function(){var object=maybeReadTaggedType(reader,ch);return object?object:readerError(reader,"No dispatch macro for ",ch)}()};exports.readDispatch=readDispatch;var readUnmatchedDelimiter=function readUnmatchedDelimiter(rdr,ch){return readerError(rdr,"Unmached delimiter ",ch)};exports.readUnmatchedDelimiter=readUnmatchedDelimiter;var readList=function readList(reader,_){var form=readDelimitedList(")",reader,true);return withMeta(list.apply(list,form),meta(form))};exports.readList=readList;var readComment=function readComment(reader,_){return function loop(buffer,ch){var recur=loop;while(recur===loop){recur=isNil(ch)||"\n"===ch?reader||list(symbol(void 0,"comment"),buffer):"\\"===ch?(buffer=""+buffer+escapeChar(buffer,reader),ch=readChar(reader),loop):"else"?(buffer=""+buffer+ch,ch=readChar(reader),loop):void 0}return recur}("",readChar(reader))};exports.readComment=readComment;var readVector=function readVector(reader){return readDelimitedList("]",reader,true)};exports.readVector=readVector;var readMap=function readMap(reader){var form=readDelimitedList("}",reader,true);return isOdd(count(form))?readerError(reader,"Map literal must contain an even number of forms"):withMeta(dictionary.apply(dictionary,form),meta(form))};exports.readMap=readMap;var readSet=function readSet(reader,_){var form=readDelimitedList("}",reader,true);return withMeta(concat([symbol(void 0,"set")],form),meta(form))};exports.readSet=readSet;var readNumber=function readNumber(reader,initch){return function loop(buffer,ch){var recur=loop;while(recur===loop){recur=isNil(ch)||isWhitespace(ch)||macros(ch)?function(){var match=matchNumber(buffer);return isNil(match)?readerError(reader,"Invalid number format [",buffer,"]"):match}():(buffer=""+buffer+readChar(reader),ch=peekChar(reader),loop)}return recur}(initch,peekChar(reader))};exports.readNumber=readNumber;var readString=function readString(reader){return function loop(buffer,ch){var recur=loop;while(recur===loop){recur=isNil(ch)?readerError(reader,"EOF while reading string"):"\\"===ch?(buffer=""+buffer+escapeChar(buffer,reader),ch=readChar(reader),loop):'"'===ch?buffer:"default"?(buffer=""+buffer+ch,ch=readChar(reader),loop):void 0}return recur}("",readChar(reader))};exports.readString=readString;var readUnquote=function readUnquote(reader){var ch=peekChar(reader);return!ch?readerError(reader,"EOF while reading character"):ch==="@"?function(){readChar(reader);return list(symbol(void 0,"unquote-splicing"),read(reader,true,void 0,true))}():list(symbol(void 0,"unquote"),read(reader,true,void 0,true))};exports.readUnquote=readUnquote;var specialSymbols=function specialSymbols(text,notFound){return text==="nil"?void 0:text==="true"?true:text==="false"?false:"else"?notFound:void 0};exports.specialSymbols=specialSymbols;var readSymbol=function readSymbol(reader,initch){var token=readToken(reader,initch);var parts=split(token,"/");var hasNs=count(parts)>1&&count(token)>1;var ns=first(parts);var name=join("/",rest(parts));return hasNs?symbol(ns,name):specialSymbols(token,symbol(token))};exports.readSymbol=readSymbol;var readKeyword=function readKeyword(reader,initch){var token=readToken(reader,readChar(reader));var parts=split(token,"/");var name=last(parts);var ns=count(parts)>1?join("/",butlast(parts)):void 0;var issue=last(ns)===":"?'namespace can\'t ends with ":"':last(name)===":"?'name can\'t end with ":"':last(name)==="/"?'name can\'t end with "/"':count(split(token,"::"))>1?'name can\'t contain "::"':void 0;return issue?readerError(reader,"Invalid token (",issue,"): ",token):!ns&&first(name)===":"?keyword(rest(name)):keyword(ns,name)};exports.readKeyword=readKeyword;var desugarMeta=function desugarMeta(f){return isKeyword(f)?dictionary(name(f),true):isSymbol(f)?{tag:f}:isString(f)?{tag:f}:"else"?f:void 0};exports.desugarMeta=desugarMeta;var wrappingReader=function wrappingReader(prefix){return function(reader){return list(prefix,read(reader,true,void 0,true))}};exports.wrappingReader=wrappingReader;var throwingReader=function throwingReader(msg){return function(reader){return readerError(reader,msg)}};exports.throwingReader=throwingReader;var readMeta=function readMeta(reader,_){var metadata=desugarMeta(read(reader,true,void 0,true));!isDictionary(metadata)?readerError(reader,"Metadata must be Symbol, Keyword, String or Map"):void 0;return function(){var form=read(reader,true,void 0,true);return isObject(form)?withMeta(form,conj(metadata,meta(form))):form}()};exports.readMeta=readMeta;var readRegex=function readRegex(reader){return function loop(buffer,ch){var recur=loop;while(recur===loop){recur=isNil(ch)?readerError(reader,"EOF while reading string"):"\\"===ch?(buffer=""+buffer+ch+readChar(reader),ch=readChar(reader),loop):'"'===ch?rePattern(buffer):"default"?(buffer=""+buffer+ch,ch=readChar(reader),loop):void 0}return recur}("",readChar(reader))};exports.readRegex=readRegex;var readParam=function readParam(reader,initch){var form=readSymbol(reader,initch);return isEqual(form,symbol("%"))?symbol("%1"):form};exports.readParam=readParam;var isParam=function isParam(form){return isSymbol(form)&&"%"===first(name(form))};exports.isParam=isParam;var lambdaParamsHash=function lambdaParamsHash(form){return isParam(form)?dictionary(form,form):isDictionary(form)||isVector(form)||isList(form)?conj.apply(conj,map(lambdaParamsHash,vec(form))):"else"?{}:void 0};exports.lambdaParamsHash=lambdaParamsHash;var lambdaParams=function lambdaParams(body){var names=sort(vals(lambdaParamsHash(body)));var variadic=isEqual(first(names),symbol("%&"));var n=variadic&&count(names)===1?0:parseInt(rest(name(last(names))));var params=function loop(names,i){var recur=loop;while(recur===loop){recur=i<=n?(names=conj(names,symbol(""+"%"+i)),i=inc(i),loop):names}return recur}([],1);return variadic?conj(params,symbol(void 0,"&"),symbol(void 0,"%&")):names};exports.lambdaParams=lambdaParams;var readLambda=function readLambda(reader){var body=readList(reader);return list(symbol(void 0,"fn"),lambdaParams(body),body)};exports.readLambda=readLambda;var readDiscard=function readDiscard(reader,_){read(reader,true,void 0,true);return reader};exports.readDiscard=readDiscard;var macros=function macros(c){return c==='"'?readString:c===":"?readKeyword:c===";"?readComment:c==="'"?wrappingReader(symbol(void 0,"quote")):c==="@"?wrappingReader(symbol(void 0,"deref")):c==="^"?readMeta:c==="`"?wrappingReader(symbol(void 0,"syntax-quote")):c==="~"?readUnquote:c==="("?readList:c===")"?readUnmatchedDelimiter:c==="["?readVector:c==="]"?readUnmatchedDelimiter:c==="{"?readMap:c==="}"?readUnmatchedDelimiter:c==="\\"?readChar:c==="%"?readParam:c==="#"?readDispatch:"else"?void 0:void 0};exports.macros=macros;var dispatchMacros=function dispatchMacros(s){return s==="{"?readSet:s==="("?readLambda:s==="<"?throwingReader("Unreadable form"):s==='"'?readRegex:s==="!"?readComment:s==="_"?readDiscard:"else"?void 0:void 0};exports.dispatchMacros=dispatchMacros;var readForm=function readForm(reader,ch){var start={line:(reader||0)["line"],column:(reader||0)["column"]};var readMacro=macros(ch);var form=readMacro?readMacro(reader,ch):isNumberLiteral(reader,ch)?readNumber(reader,ch):"else"?readSymbol(reader,ch):void 0;return form===reader?form:!(isString(form)||isNumber(form)||isBoolean(form)||isNil(form)||isKeyword(form))?withMeta(form,conj({start:start,end:{line:(reader||0)["line"],column:(reader||0)["column"]}},meta(form))):"else"?form:void 0};exports.readForm=readForm;var read=function read(reader,eofIsError,sentinel,isRecursive){return function loop(){var recur=loop;while(recur===loop){recur=function(){var ch=readChar(reader);var form=isNil(ch)?eofIsError?readerError(reader,"EOF"):sentinel:isWhitespace(ch)?reader:isCommentPrefix(ch)?read(readComment(reader,ch),eofIsError,sentinel,isRecursive):"else"?readForm(reader,ch):void 0;return form===reader?loop:form}()}return recur}()};exports.read=read;var read_=function read_(source,uri){var reader=pushBackReader(source,uri);var eof=gensym();return function loop(forms,form){var recur=loop;while(recur===loop){recur=form===eof?forms:(forms=conj(forms,form),form=read(reader,false,eof,false),loop)}return recur}([],read(reader,false,eof,false))};exports.read_=read_;var readFromString=function readFromString(source,uri){var reader=pushBackReader(source,uri);return read(reader,true,void 0,false)};exports.readFromString=readFromString;var readUuid=function readUuid(uuid){return isString(uuid)?list(symbol(void 0,"UUID."),uuid):readerError(void 0,"UUID literal expects a string as its representation.")};var readQueue=function readQueue(items){return isVector(items)?list(symbol(void 0,"PersistentQueue."),items):readerError(void 0,"Queue literal expects a vector for its elements.")};var __tagTable__=dictionary("uuid",readUuid,"queue",readQueue);exports.__tagTable__=__tagTable__;var maybeReadTaggedType=function maybeReadTaggedType(reader,initch){var tag=readSymbol(reader,initch);var pfn=(__tagTable__||0)[name(tag)];return pfn?pfn(read(reader,true,void 0,false)):readerError(reader,""+"Could not find tag parser for "+name(tag)+" in "+(""+keys(__tagTable__)))};exports.maybeReadTaggedType=maybeReadTaggedType},{"./sequence":3,"./runtime":2,"./ast":6,"./string":7}],5:[function(require,module,exports){var _ns_={id:"wisp.compiler",doc:"wisp language compiler"};var wisp_reader=require("./reader");var readFromString=wisp_reader.readFromString;var wisp_ast=require("./ast");var meta=wisp_ast.meta;var withMeta=wisp_ast.withMeta;var isSymbol=wisp_ast.isSymbol;var symbol=wisp_ast.symbol;var isKeyword=wisp_ast.isKeyword;var keyword=wisp_ast.keyword;var namespace=wisp_ast.namespace;var isUnquote=wisp_ast.isUnquote;var isUnquoteSplicing=wisp_ast.isUnquoteSplicing;var isQuote=wisp_ast.isQuote;var isSyntaxQuote=wisp_ast.isSyntaxQuote;var name=wisp_ast.name;var gensym=wisp_ast.gensym;var prStr=wisp_ast.prStr;var wisp_sequence=require("./sequence");var isEmpty=wisp_sequence.isEmpty;var count=wisp_sequence.count;var isList=wisp_sequence.isList;var list=wisp_sequence.list;var first=wisp_sequence.first;var second=wisp_sequence.second;var third=wisp_sequence.third;var rest=wisp_sequence.rest;var cons=wisp_sequence.cons;var conj=wisp_sequence.conj;var reverse=wisp_sequence.reverse;var reduce=wisp_sequence.reduce;var vec=wisp_sequence.vec;var last=wisp_sequence.last;var repeat=wisp_sequence.repeat;var map=wisp_sequence.map;var filter=wisp_sequence.filter;var take=wisp_sequence.take;var concat=wisp_sequence.concat;var isSeq=wisp_sequence.isSeq;var wisp_runtime=require("./runtime");var isOdd=wisp_runtime.isOdd;var isDictionary=wisp_runtime.isDictionary;var dictionary=wisp_runtime.dictionary;var merge=wisp_runtime.merge;var keys=wisp_runtime.keys;var vals=wisp_runtime.vals;var isContainsVector=wisp_runtime.isContainsVector;var mapDictionary=wisp_runtime.mapDictionary;var isString=wisp_runtime.isString;var isNumber=wisp_runtime.isNumber;var isVector=wisp_runtime.isVector;var isBoolean=wisp_runtime.isBoolean;var subs=wisp_runtime.subs;var reFind=wisp_runtime.reFind;var isTrue=wisp_runtime.isTrue;var isFalse=wisp_runtime.isFalse;var isNil=wisp_runtime.isNil;var isRePattern=wisp_runtime.isRePattern;var inc=wisp_runtime.inc;var dec=wisp_runtime.dec;var str=wisp_runtime.str;var char=wisp_runtime.char;var int=wisp_runtime.int;var isEqual=wisp_runtime.isEqual;var isStrictEqual=wisp_runtime.isStrictEqual;var wisp_string=require("./string");var split=wisp_string.split;var join=wisp_string.join;var upperCase=wisp_string.upperCase;var replace=wisp_string.replace;var wisp_backend_javascript_writer=require("./backend/javascript/writer");var writeReference=wisp_backend_javascript_writer.writeReference;var writeKeywordReference=wisp_backend_javascript_writer.writeKeywordReference;var writeKeyword=wisp_backend_javascript_writer.writeKeyword;var writeSymbol=wisp_backend_javascript_writer.writeSymbol;var writeNil=wisp_backend_javascript_writer.writeNil;var writeComment=wisp_backend_javascript_writer.writeComment;var writeNumber=wisp_backend_javascript_writer.writeNumber;var writeString=wisp_backend_javascript_writer.writeString;var writeBoolean=wisp_backend_javascript_writer.writeBoolean;var isSelfEvaluating=function isSelfEvaluating(form){return isNumber(form)||isString(form)&&!isSymbol(form)&&!isKeyword(form)||isBoolean(form)||isNil(form)||isRePattern(form)};exports.isSelfEvaluating=isSelfEvaluating;var __macros__={};exports.__macros__=__macros__;var executeMacro=function executeMacro(name,form){return(__macros__||0)[name].apply((__macros__||0)[name],vec(form))};exports.executeMacro=executeMacro;var installMacro=function installMacro(name,macroFn){return(__macros__||0)[name]=macroFn};exports.installMacro=installMacro;var isMacro=function isMacro(name){return isSymbol(name)&&(__macros__||0)[name]&&true};exports.isMacro=isMacro;var makeMacro=function makeMacro(pattern,body){var macroFn=concat(list(symbol(void 0,"fn"),pattern),body);return eval(""+"("+compile(macroexpand(macroFn))+")")};exports.makeMacro=makeMacro;installMacro(symbol(void 0,"defmacro"),function(name,signature){var body=Array.prototype.slice.call(arguments,2);return installMacro(name,makeMacro(signature,body))});var __specials__={};exports.__specials__=__specials__;var installSpecial=function installSpecial(name,f,validator){return(__specials__||0)[name]=function(form){validator?validator(form):void 0;return f(withMeta(rest(form),meta(form)))}};exports.installSpecial=installSpecial;var isSpecial=function isSpecial(name){return isSymbol(name)&&(__specials__||0)[name]&&true};exports.isSpecial=isSpecial;var executeSpecial=function executeSpecial(name,form){return(__specials__||0)[name](form)};exports.executeSpecial=executeSpecial;var opt=function opt(argument,fallback){return isNil(argument)||isEmpty(argument)?fallback:first(argument)};exports.opt=opt;var applyForm=function applyForm(fnName,form,isQuoted){return cons(fnName,isQuoted?map(function(e){return list(symbol(void 0,"quote"),e)},form):form,form)};exports.applyForm=applyForm;var applyUnquotedForm=function applyUnquotedForm(fnName,form){return cons(fnName,map(function(e){return isUnquote(e)?second(e):isList(e)&&isKeyword(first(e))?list(symbol(void 0,"syntax-quote"),second(e)):list(symbol(void 0,"syntax-quote"),e)},form))};exports.applyUnquotedForm=applyUnquotedForm;var splitSplices=function splitSplices(form,fnName){var makeSplice=function makeSplice(form){return isSelfEvaluating(form)||isSymbol(form)?applyUnquotedForm(fnName,list(form)):applyUnquotedForm(fnName,form)};return function loop(nodes,slices,acc){var recur=loop;while(recur===loop){recur=isEmpty(nodes)?reverse(isEmpty(acc)?slices:cons(makeSplice(reverse(acc)),slices)):function(){var node=first(nodes);return isUnquoteSplicing(node)?(nodes=rest(nodes),slices=cons(second(node),isEmpty(acc)?slices:cons(makeSplice(reverse(acc)),slices)),acc=list(),loop):(nodes=rest(nodes),slices=slices,acc=cons(node,acc),loop)}()}return recur}(form,list(),list())};exports.splitSplices=splitSplices;var syntaxQuoteSplit=function syntaxQuoteSplit(appendName,fnName,form){var slices=splitSplices(form,fnName);var n=count(slices);return n===0?list(fnName):n===1?first(slices):"default"?applyForm(appendName,slices):void 0};exports.syntaxQuoteSplit=syntaxQuoteSplit;var compileObject=function compileObject(form,isQuoted){return isKeyword(form)?writeKeyword(form):isSymbol(form)?writeSymbol(form):isNumber(form)?writeNumber(form):isString(form)?writeString(form):isBoolean(form)?writeBoolean(form):isNil(form)?writeNil(form):isRePattern(form)?compileRePattern(form):isVector(form)?compile(applyForm(symbol(void 0,"vector"),list.apply(list,form),isQuoted)):isList(form)?compile(applyForm(symbol(void 0,"list"),form,isQuoted)):isDictionary(form)?compileDictionary(isQuoted?mapDictionary(form,function(x){return list(symbol(void 0,"quote"),x)}):form):void 0};exports.compileObject=compileObject;var compileSyntaxQuotedVector=function compileSyntaxQuotedVector(form){var concatForm=syntaxQuoteSplit(symbol(void 0,"concat"),symbol(void 0,"vector"),list.apply(list,form));return compile(count(concatForm)>1?list(symbol(void 0,"vec"),concatForm):concatForm)};exports.compileSyntaxQuotedVector=compileSyntaxQuotedVector;var compileSyntaxQuoted=function compileSyntaxQuoted(form){return isList(form)?compile(syntaxQuoteSplit(symbol(void 0,"concat"),symbol(void 0,"list"),form)):isVector(form)?compileSyntaxQuotedVector(form):"else"?compileObject(form):void 0};exports.compileSyntaxQuoted=compileSyntaxQuoted;var compile=function compile(form){return isSelfEvaluating(form)?compileObject(form):isSymbol(form)?writeReference(form):isKeyword(form)?writeKeywordReference(form):isVector(form)?compileObject(form):isDictionary(form)?compileObject(form):isList(form)?function(){var head=first(form);return isEmpty(form)?compileObject(form,true):isQuote(form)?compileObject(second(form),true):isSyntaxQuote(form)?compileSyntaxQuoted(second(form)):isSpecial(head)?executeSpecial(head,form):isKeyword(head)?compile(list(symbol(void 0,"get"),second(form),head)):"else"?function(){return!(isSymbol(head)||isList(head))?function(){throw compilerError(form,""+"operator is not a procedure: "+head)}():compileInvoke(form)}():void 0}():void 0};exports.compile=compile;var compile_=function compile_(forms){return reduce(function(result,form){return""+result+(isEmpty(result)?"":";\n\n")+compile(isList(form)?withMeta(macroexpand(form),conj({top:true},meta(form))):form)},"",forms)};exports.compile_=compile_;var compileProgram=function compileProgram(forms){return reduce(function(result,form){return""+result+(isEmpty(result)?"":";\n\n")+compile(isList(form)?withMeta(macroexpand(form),conj({top:true},meta(form))):form)},"",forms)};exports.compileProgram=compileProgram;var macroexpand1=function macroexpand1(form){return isList(form)?function(){var op=first(form);var id=isSymbol(op)?name(op):void 0;return isSpecial(op)?form:isMacro(op)?executeMacro(op,rest(form)):isSymbol(op)&&!(id===".")?first(id)==="."?count(form)<2?function(){throw Error("Malformed member expression, expecting (.member target ...)")}():cons(symbol(void 0,"."),cons(second(form),cons(symbol(subs(id,1)),rest(rest(form))))):last(id)==="."?cons(symbol(void 0,"new"),cons(symbol(subs(id,0,dec(count(id)))),rest(form))):form:"else"?form:void 0}():form};exports.macroexpand1=macroexpand1;var macroexpand=function macroexpand(form){return function loop(original,expanded){var recur=loop;while(recur===loop){recur=original===expanded?original:(original=expanded,expanded=macroexpand1(expanded),loop)}return recur}(form,macroexpand1(form))};exports.macroexpand=macroexpand;var _lineBreakPattern_=/\n(?=[^\n])/m;exports._lineBreakPattern_=_lineBreakPattern_;var indent=function indent(code,indentation){return join(indentation,split(code,_lineBreakPattern_))};exports.indent=indent;var compileTemplate=function compileTemplate(form){var indentPattern=/\n *$/;var getIndentation=function(code){return reFind(indentPattern,code)||"\n"};return function loop(code,parts,values){var recur=loop;while(recur===loop){recur=count(parts)>1?(code=""+code+first(parts)+indent(""+first(values),getIndentation(first(parts))),parts=rest(parts),values=rest(values),loop):""+code+first(parts)}return recur}("",split(first(form),"~{}"),rest(form))};exports.compileTemplate=compileTemplate;var compileDef=function compileDef(form){var id=first(form);var isExport=(meta(form)||{}||0)["top"]&&!(meta(id)||{}||0)["private"];var attribute=symbol(namespace(id),""+"-"+name(id));return isExport?compileTemplate(list("var ~{};\n~{}",compile(cons(symbol(void 0,"set!"),form)),compile(list(symbol(void 0,"set!"),list(symbol(void 0,"."),symbol(void 0,"exports"),attribute),id)))):compileTemplate(list("var ~{}",compile(cons(symbol(void 0,"set!"),form))))};exports.compileDef=compileDef;var compileIfElse=function compileIfElse(form){var condition=macroexpand(first(form));var thenExpression=macroexpand(second(form));var elseExpression=macroexpand(third(form));return compileTemplate(list(isList(elseExpression)&&isEqual(first(elseExpression),symbol(void 0,"if"))?"~{} ?\n  ~{} :\n~{}":"~{} ?\n  ~{} :\n  ~{}",compile(condition),compile(thenExpression),compile(elseExpression)))};exports.compileIfElse=compileIfElse;var compileDictionary=function compileDictionary(form){var body=function loop(body,names){var recur=loop;while(recur===loop){recur=isEmpty(names)?body:(body=""+(isNil(body)?"":""+body+",\n")+compileTemplate(list("~{}: ~{}",compile(first(names)),compile(macroexpand((form||0)[first(names)])))),names=rest(names),loop)}return recur}(void 0,keys(form));return isNil(body)?"{}":compileTemplate(list("{\n  ~{}\n}",body))};exports.compileDictionary=compileDictionary;var desugarFnName=function desugarFnName(form){return isSymbol(first(form))||isNil(first(form))?form:cons(void 0,form)};exports.desugarFnName=desugarFnName;var desugarFnDoc=function desugarFnDoc(form){return isString(second(form))||isNil(second(form))?form:cons(first(form),cons(void 0,rest(form)))};exports.desugarFnDoc=desugarFnDoc;var desugarFnAttrs=function desugarFnAttrs(form){return isDictionary(third(form))||isNil(third(form))?form:cons(first(form),cons(second(form),cons(void 0,rest(rest(form)))))};exports.desugarFnAttrs=desugarFnAttrs;var compileDesugaredFn=function compileDesugaredFn(name,doc,attrs,params,body){return compileTemplate(isNil(name)?list("function(~{}) {\n  ~{}\n}",join(", ",map(compile,(params||0)["names"])),compileFnBody(map(macroexpand,body),params)):list("function ~{}(~{}) {\n  ~{}\n}",compile(name),join(", ",map(compile,(params||0)["names"])),compileFnBody(map(macroexpand,body),params)))};exports.compileDesugaredFn=compileDesugaredFn;var compileStatements=function compileStatements(form,prefix){return function loop(result,expression,expressions){var recur=loop;while(recur===loop){recur=isEmpty(expressions)?""+result+(isNil(prefix)?"":prefix)+compile(macroexpand(expression))+";":(result=""+result+compile(macroexpand(expression))+";\n",expression=first(expressions),expressions=rest(expressions),loop)}return recur}("",first(form),rest(form))};exports.compileStatements=compileStatements;var compileFnBody=function compileFnBody(form,params){return isDictionary(params)&&(params||0)["rest"]?compileStatements(cons(list(symbol(void 0,"def"),(params||0)["rest"],list(symbol(void 0,"Array.prototype.slice.call"),symbol(void 0,"arguments"),(params||0)["arity"])),form),"return "):count(form)===1&&isList(first(form))&&isEqual(first(first(form)),symbol(void 0,"do"))?compileFnBody(rest(first(form)),params):compileStatements(form,"return ")};exports.compileFnBody=compileFnBody;var desugarParams=function desugarParams(params){return function loop(names,params){var recur=loop;while(recur===loop){recur=isEmpty(params)?{names:names,arity:count(names),rest:void 0}:isEqual(first(params),symbol(void 0,"&"))?isEqual(count(params),1)?{names:names,arity:count(names),rest:void 0}:isEqual(count(params),2)?{names:names,arity:count(names),rest:second(params)}:"else"?function(){throw TypeError("Unexpected number of parameters after &")}():void 0:"else"?(names=conj(names,first(params)),params=rest(params),loop):void 0}return recur}([],params)};exports.desugarParams=desugarParams;var analyzeOverloadedFn=function analyzeOverloadedFn(name,doc,attrs,overloads){return map(function(overload){var params=desugarParams(first(overload));return{rest:(params||0)["rest"],names:(params||0)["names"],arity:(params||0)["arity"],body:rest(overload)}},overloads)};exports.analyzeOverloadedFn=analyzeOverloadedFn;var compileOverloadedFn=function compileOverloadedFn(name,doc,attrs,overloads){var methods=analyzeOverloadedFn(name,doc,attrs,overloads);var fixedMethods=filter(function(method){return!(method||0)["rest"]},methods);var variadic=first(filter(function(method){return(method||0)["rest"]},methods));var names=reduce(function(names,params){return count(names)>(params||0)["arity"]?names:(params||0)["names"]},[],methods);return list(symbol(void 0,"fn"),name,doc,attrs,names,list(symbol(void 0,"raw*"),compileSwitch(symbol(void 0,"arguments.length"),map(function(method){return cons((method||0)["arity"],list(symbol(void 0,"raw*"),compileFnBody(concat(compileRebind(names,(method||0)["names"]),(method||0)["body"]))))},fixedMethods),isNil(variadic)?list(symbol(void 0,"throw"),list(symbol(void 0,"Error"),"Invalid arity")):list(symbol(void 0,"raw*"),compileFnBody(concat(compileRebind(cons(list(symbol(void 0,"Array.prototype.slice.call"),symbol(void 0,"arguments"),(variadic||0)["arity"]),names),cons((variadic||0)["rest"],(variadic||0)["names"])),(variadic||0)["body"]))))),void 0)};exports.compileOverloadedFn=compileOverloadedFn;var compileRebind=function compileRebind(bindings,names){return function loop(form,bindings,names){var recur=loop;while(recur===loop){recur=isEmpty(names)?reverse(form):(form=isEqual(first(names),first(bindings))?form:cons(list(symbol(void 0,"def"),first(names),first(bindings)),form),bindings=rest(bindings),names=rest(names),loop)}return recur}(list(),bindings,names)};exports.compileRebind=compileRebind;var compileSwitchCases=function compileSwitchCases(cases){return reduce(function(form,caseExpression){return""+form+compileTemplate(list("case ~{}:\n  ~{}\n",compile(macroexpand(first(caseExpression))),compile(macroexpand(rest(caseExpression)))))},"",cases)};exports.compileSwitchCases=compileSwitchCases;var compileSwitch=function compileSwitch(value,cases,defaultCase){return compileTemplate(list("switch (~{}) {\n  ~{}\n  default:\n    ~{}\n}",compile(macroexpand(value)),compileSwitchCases(cases),compile(macroexpand(defaultCase))))};exports.compileSwitch=compileSwitch;var compileFn=function compileFn(form){var signature=desugarFnAttrs(desugarFnDoc(desugarFnName(form)));var name=first(signature);var doc=second(signature);var attrs=third(signature);return isVector(third(rest(signature)))?compileDesugaredFn(name,doc,attrs,desugarParams(third(rest(signature))),rest(rest(rest(rest(signature))))):compile(compileOverloadedFn(name,doc,attrs,rest(rest(rest(signature)))))};exports.compileFn=compileFn;var compileInvoke=function compileInvoke(form){return compileTemplate(list(isList(first(form))?"(~{})(~{})":"~{}(~{})",compile(first(form)),compileGroup(rest(form))))};exports.compileInvoke=compileInvoke;var compileGroup=function compileGroup(form,wrap){return wrap?""+"("+compileGroup(form)+")":join(", ",vec(map(compile,map(macroexpand,form))))};exports.compileGroup=compileGroup;var compileDo=function compileDo(form){return compile(list(cons(symbol(void 0,"fn"),cons([],form))))};exports.compileDo=compileDo;var defineBindings=function defineBindings(form){return function loop(defs,bindings){var recur=loop;while(recur===loop){recur=count(bindings)===0?reverse(defs):(defs=cons(list(symbol(void 0,"def"),(bindings||0)[0],(bindings||0)[1]),defs),bindings=rest(rest(bindings)),loop)}return recur}(list(),form)};exports.defineBindings=defineBindings;var compileThrow=function compileThrow(form){return compileTemplate(list("(function() { throw ~{}; })()",compile(macroexpand(first(form)))))};exports.compileThrow=compileThrow;var compileSet=function compileSet(form){return compileTemplate(list("~{} = ~{}",compile(macroexpand(first(form))),compile(macroexpand(second(form)))))};exports.compileSet=compileSet;var compileVector=function compileVector(form){return compileTemplate(list("[~{}]",compileGroup(form)))};exports.compileVector=compileVector;var compileTry=function compileTry(form){return function loop(tryExprs,catchExprs,finallyExprs,exprs){var recur=loop;while(recur===loop){recur=isEmpty(exprs)?isEmpty(catchExprs)?compileTemplate(list("(function() {\ntry {\n  ~{}\n} finally {\n  ~{}\n}})()",compileFnBody(tryExprs),compileFnBody(finallyExprs))):isEmpty(finallyExprs)?compileTemplate(list("(function() {\ntry {\n  ~{}\n} catch (~{}) {\n  ~{}\n}})()",compileFnBody(tryExprs),compile(first(catchExprs)),compileFnBody(rest(catchExprs)))):compileTemplate(list("(function() {\ntry {\n  ~{}\n} catch (~{}) {\n  ~{}\n} finally {\n  ~{}\n}})()",compileFnBody(tryExprs),compile(first(catchExprs)),compileFnBody(rest(catchExprs)),compileFnBody(finallyExprs))):isEqual(first(first(exprs)),symbol(void 0,"catch"))?(tryExprs=tryExprs,catchExprs=rest(first(exprs)),finallyExprs=finallyExprs,exprs=rest(exprs),loop):isEqual(first(first(exprs)),symbol(void 0,"finally"))?(tryExprs=tryExprs,catchExprs=catchExprs,finallyExprs=rest(first(exprs)),exprs=rest(exprs),loop):(tryExprs=cons(first(exprs),tryExprs),catchExprs=catchExprs,finallyExprs=finallyExprs,exprs=rest(exprs),loop)}return recur}(list(),list(),list(),reverse(form))};exports.compileTry=compileTry;var compileProperty=function compileProperty(form){return name(second(form))[0]==="-"?compileTemplate(list(isList(first(form))?"(~{}).~{}":"~{}.~{}",compile(macroexpand(first(form))),compile(macroexpand(symbol(subs(name(second(form)),1)))))):compileTemplate(list("~{}.~{}(~{})",compile(macroexpand(first(form))),compile(macroexpand(second(form))),compileGroup(rest(rest(form)))))};exports.compileProperty=compileProperty;var compileApply=function compileApply(form){return compile(list(symbol(void 0,"."),first(form),symbol(void 0,"apply"),first(form),second(form)))};exports.compileApply=compileApply;var compileNew=function compileNew(form){return compileTemplate(list("new ~{}",compile(form)))};exports.compileNew=compileNew;var compileAget=function compileAget(form){var target=macroexpand(first(form));var attribute=macroexpand(second(form));var notFound=third(form);var template=isList(target)?"(~{})[~{}]":"~{}[~{}]";return notFound?compile(list(symbol(void 0,"or"),list(symbol(void 0,"get"),first(form),second(form)),macroexpand(notFound))):compileTemplate(list(template,compile(target),compile(attribute)))};exports.compileAget=compileAget;var compileGet=function compileGet(form){return compileAget(cons(list(symbol(void 0,"or"),first(form),0),rest(form)))};exports.compileGet=compileGet;var compileInstance=function compileInstance(form){return compileTemplate(list("~{} instanceof ~{}",compile(macroexpand(second(form))),compile(macroexpand(first(form)))))};exports.compileInstance=compileInstance;var compileNot=function compileNot(form){return compileTemplate(list("!(~{})",compile(macroexpand(first(form)))))};exports.compileNot=compileNot;var compileLoop=function compileLoop(form){var bindings=function loop(names,values,tokens){var recur=loop;while(recur===loop){recur=isEmpty(tokens)?{names:names,values:values}:(names=conj(names,first(tokens)),values=conj(values,second(tokens)),tokens=rest(rest(tokens)),loop)}return recur}([],[],first(form));var names=(bindings||0)["names"];var values=(bindings||0)["values"];var body=rest(form);return compile(cons(cons(symbol(void 0,"fn"),cons(symbol(void 0,"loop"),cons(names,compileRecur(names,body)))),list.apply(list,values)))};exports.compileLoop=compileLoop;var rebindBindings=function rebindBindings(names,values){return function loop(result,names,values){var recur=loop;while(recur===loop){recur=isEmpty(names)?reverse(result):(result=cons(list(symbol(void 0,"set!"),first(names),first(values)),result),names=rest(names),values=rest(values),loop)}return recur}(list(),names,values)};exports.rebindBindings=rebindBindings;var expandRecur=function expandRecur(names,body){return map(function(form){return isList(form)?isEqual(first(form),symbol(void 0,"recur"))?list(symbol(void 0,"raw*"),compileGroup(concat(rebindBindings(names,rest(form)),list(symbol(void 0,"loop"))),true)):expandRecur(names,form):form
},body)};exports.expandRecur=expandRecur;var compileRecur=function compileRecur(names,body){return list(list(symbol(void 0,"raw*"),compileTemplate(list("var recur = loop;\nwhile (recur === loop) {\n  recur = ~{}\n}",compileStatements(expandRecur(names,body))))),symbol(void 0,"recur"))};exports.compileRecur=compileRecur;var compileRaw=function compileRaw(form){return first(form)};exports.compileRaw=compileRaw;installSpecial(symbol(void 0,"set!"),compileSet);installSpecial(symbol(void 0,"get"),compileGet);installSpecial(symbol(void 0,"aget"),compileAget);installSpecial(symbol(void 0,"def"),compileDef);installSpecial(symbol(void 0,"if"),compileIfElse);installSpecial(symbol(void 0,"do"),compileDo);installSpecial(symbol(void 0,"do*"),compileStatements);installSpecial(symbol(void 0,"fn"),compileFn);installSpecial(symbol(void 0,"throw"),compileThrow);installSpecial(symbol(void 0,"vector"),compileVector);installSpecial(symbol(void 0,"try"),compileTry);installSpecial(symbol(void 0,"."),compileProperty);installSpecial(symbol(void 0,"apply"),compileApply);installSpecial(symbol(void 0,"new"),compileNew);installSpecial(symbol(void 0,"instance?"),compileInstance);installSpecial(symbol(void 0,"not"),compileNot);installSpecial(symbol(void 0,"loop"),compileLoop);installSpecial(symbol(void 0,"raw*"),compileRaw);installSpecial(symbol(void 0,"comment"),writeComment);var compileRePattern=function compileRePattern(form){return""+form};exports.compileRePattern=compileRePattern;var installNative=function installNative(alias,operator,validator,fallback){return installSpecial(alias,function(form){return isEmpty(form)?fallback:reduce(function(left,right){return compileTemplate(list("~{} ~{} ~{}",left,name(operator),right))},map(function(operand){return compileTemplate(list(isList(operand)?"(~{})":"~{}",compile(macroexpand(operand))))},form))},validator)};exports.installNative=installNative;var installOperator=function installOperator(alias,operator){return installSpecial(alias,function(form){return function loop(result,left,right,operands){var recur=loop;while(recur===loop){recur=isEmpty(operands)?""+result+compileTemplate(list("~{} ~{} ~{}",compile(macroexpand(left)),name(operator),compile(macroexpand(right)))):(result=""+result+compileTemplate(list("~{} ~{} ~{} && ",compile(macroexpand(left)),name(operator),compile(macroexpand(right)))),left=right,right=first(operands),operands=rest(operands),loop)}return recur}("",first(form),second(form),rest(rest(form)))},verifyTwo)};exports.installOperator=installOperator;var compilerError=function compilerError(form,message){var error=Error(""+message);error.line=1;return function(){throw error}()};exports.compilerError=compilerError;var verifyTwo=function verifyTwo(form){return isEmpty(rest(form))||isEmpty(rest(rest(form)))?function(){throw compilerError(form,""+first(form)+" form requires at least two operands")}():void 0};exports.verifyTwo=verifyTwo;installNative(symbol(void 0,"+"),symbol(void 0,"+"),void 0,0);installNative(symbol(void 0,"-"),symbol(void 0,"-"),void 0,"NaN");installNative(symbol(void 0,"*"),symbol(void 0,"*"),void 0,1);installNative(symbol(void 0,"/"),symbol(void 0,"/"),verifyTwo);installNative(symbol(void 0,"mod"),symbol("%"),verifyTwo);installNative(symbol(void 0,"and"),symbol(void 0,"&&"));installNative(symbol(void 0,"or"),symbol(void 0,"||"));installOperator(symbol(void 0,"not="),symbol(void 0,"!="));installOperator(symbol(void 0,"=="),symbol(void 0,"==="));installOperator(symbol(void 0,"identical?"),symbol(void 0,"==="));installOperator(symbol(void 0,">"),symbol(void 0,">"));installOperator(symbol(void 0,">="),symbol(void 0,">="));installOperator(symbol(void 0,"<"),symbol(void 0,"<"));installOperator(symbol(void 0,"<="),symbol(void 0,"<="));installNative(symbol(void 0,"bit-and"),symbol(void 0,"&"),verifyTwo);installNative(symbol(void 0,"bit-or"),symbol(void 0,"|"),verifyTwo);installNative(symbol(void 0,"bit-xor"),symbol("^"));installNative(symbol(void 0,"bit-not"),symbol("~"),verifyTwo);installNative(symbol(void 0,"bit-shift-left"),symbol(void 0,"<<"),verifyTwo);installNative(symbol(void 0,"bit-shift-right"),symbol(void 0,">>"),verifyTwo);installNative(symbol(void 0,"bit-shift-right-zero-fil"),symbol(void 0,">>>"),verifyTwo);installMacro(symbol(void 0,"str"),function str(){var forms=Array.prototype.slice.call(arguments,0);return concat(list(symbol(void 0,"+"),""),forms)});installMacro(symbol(void 0,"let"),function letMacro(bindings){var body=Array.prototype.slice.call(arguments,1);return cons(symbol(void 0,"do"),concat(defineBindings(bindings),body))});installMacro(symbol(void 0,"cond"),function cond(){var clauses=Array.prototype.slice.call(arguments,0);return!isEmpty(clauses)?list(symbol(void 0,"if"),first(clauses),isEmpty(rest(clauses))?function(){throw Error("cond requires an even number of forms")}():second(clauses),cons(symbol(void 0,"cond"),rest(rest(clauses)))):void 0});installMacro(symbol(void 0,"defn"),function defn(name){var body=Array.prototype.slice.call(arguments,1);return list(symbol(void 0,"def"),name,concat(list(symbol(void 0,"fn"),name),body))});installMacro(symbol(void 0,"defn-"),function defn(name){var body=Array.prototype.slice.call(arguments,1);return concat(list(symbol(void 0,"defn"),withMeta(name,conj({"private":true},meta(name)))),body)});installMacro(symbol(void 0,"assert"),function assert(x,message){var title=message||"";var assertion=prStr(x);var uri=(x||0)["uri"];var form=isList(x)?second(x):x;return list(symbol(void 0,"do"),list(symbol(void 0,"if"),list(symbol(void 0,"and"),list(symbol(void 0,"not"),list(symbol(void 0,"identical?"),list(symbol(void 0,"typeof"),symbol(void 0,"**verbose**")),"undefined")),symbol(void 0,"**verbose**")),list(symbol(void 0,".log"),symbol(void 0,"console"),"Assert:",assertion)),list(symbol(void 0,"if"),list(symbol(void 0,"not"),x),list(symbol(void 0,"throw"),list(symbol(void 0,"Error."),list(symbol(void 0,"str"),"Assert failed: ",title,"\n\nAssertion:\n\n",assertion,"\n\nActual:\n\n",form,"\n--------------\n"),uri))))});var parseReferences=function parseReferences(forms){return reduce(function(references,form){isSeq(form)?(references||0)[name(first(form))]=vec(rest(form)):void 0;return references},{},forms)};exports.parseReferences=parseReferences;var parseRequire=function parseRequire(form){var requirement=isSymbol(form)?[form]:vec(form);var id=first(requirement);var params=dictionary.apply(dictionary,rest(requirement));var imports=reduce(function(imports,name){(imports||0)[name]=(imports||0)[name]||name;return imports},conj({},(params||0)["꞉rename"]),(params||0)["꞉refer"]);return conj({id:id,imports:imports},params)};exports.parseRequire=parseRequire;var analyzeNs=function analyzeNs(form){var id=first(form);var params=rest(form);var doc=isString(first(params))?first(params):void 0;var references=parseReferences(doc?rest(params):params);return withMeta(form,{id:id,doc:doc,require:(references||0)["require"]?map(parseRequire,(references||0)["require"]):void 0})};exports.analyzeNs=analyzeNs;var idToNs=function idToNs(id){return symbol(void 0,join("*",split(""+id,".")))};exports.idToNs=idToNs;var nameToField=function nameToField(name){return symbol(void 0,""+"-"+name)};exports.nameToField=nameToField;var compileImport=function compileImport(module){return function(form){return list(symbol(void 0,"def"),second(form),list(symbol(void 0,"."),module,nameToField(first(form))))}};exports.compileImport=compileImport;var compileRequire=function compileRequire(requirer){return function(form){var id=(form||0)["id"];var requirement=idToNs((form||0)["꞉as"]||id);var path=resolve(requirer,id);var imports=(form||0)["imports"];return concat([symbol(void 0,"do*"),list(symbol(void 0,"def"),requirement,list(symbol(void 0,"require"),path))],imports?map(compileImport(requirement),imports):void 0)}};exports.compileRequire=compileRequire;var resolve=function resolve(from,to){var requirer=split(""+from,".");var requirement=split(""+to,".");var isRelative=!(""+from===""+to)&&first(requirer)===first(requirement);return isRelative?function loop(from,to){var recur=loop;while(recur===loop){recur=first(from)===first(to)?(from=rest(from),to=rest(to),loop):join("/",concat(["."],repeat(dec(count(from)),".."),to))}return recur}(requirer,requirement):join("/",requirement)};exports.resolve=resolve;var compileNs=function compileNs(){var form=Array.prototype.slice.call(arguments,0);return function(){var metadata=meta(analyzeNs(form));var id=""+(metadata||0)["id"];var doc=(metadata||0)["doc"];var requirements=(metadata||0)["require"];var ns=doc?{id:id,doc:doc}:{id:id};return concat([symbol(void 0,"do*"),list(symbol(void 0,"def"),symbol(void 0,"*ns*"),ns)],requirements?map(compileRequire(id),requirements):void 0)}()};exports.compileNs=compileNs;installMacro(symbol(void 0,"ns"),compileNs);installMacro(symbol(void 0,"print"),function(){var more=Array.prototype.slice.call(arguments,0);"Prints the object(s) to the output for human consumption.";return concat(list(symbol(void 0,".log"),symbol(void 0,"console")),more)})},{"./reader":4,"./ast":6,"./sequence":3,"./runtime":2,"./string":7,"./backend/javascript/writer":8}],6:[function(require,module,exports){var _ns_={id:"wisp.ast"};var wisp_sequence=require("./sequence");var isList=wisp_sequence.isList;var isSequential=wisp_sequence.isSequential;var first=wisp_sequence.first;var second=wisp_sequence.second;var count=wisp_sequence.count;var last=wisp_sequence.last;var map=wisp_sequence.map;var vec=wisp_sequence.vec;var wisp_string=require("./string");var split=wisp_string.split;var join=wisp_string.join;var wisp_runtime=require("./runtime");var isNil=wisp_runtime.isNil;var isVector=wisp_runtime.isVector;var isNumber=wisp_runtime.isNumber;var isString=wisp_runtime.isString;var isBoolean=wisp_runtime.isBoolean;var isObject=wisp_runtime.isObject;var isDate=wisp_runtime.isDate;var isRePattern=wisp_runtime.isRePattern;var isDictionary=wisp_runtime.isDictionary;var str=wisp_runtime.str;var inc=wisp_runtime.inc;var subs=wisp_runtime.subs;var isEqual=wisp_runtime.isEqual;var withMeta=function withMeta(value,metadata){Object.defineProperty(value,"metadata",{value:metadata,configurable:true});return value};exports.withMeta=withMeta;var meta=function meta(value){return isObject(value)?value.metadata:void 0};exports.meta=meta;var __nsSeparator__="⁄";exports.__nsSeparator__=__nsSeparator__;var Symbol=function Symbol(namespace,name){this.namespace=namespace;this.name=name;return this};Symbol.type="wisp.symbol";Symbol.prototype.type=Symbol.type;Symbol.prototype.toString=function(){var ns=namespace(this);return ns?""+ns+"/"+name(this):""+name(this)};var symbol=function symbol(ns,id){return isSymbol(ns)?ns:isKeyword(ns)?new Symbol(namespace(ns),name(ns)):isNil(id)?new Symbol(void 0,ns):"else"?new Symbol(ns,id):void 0};exports.symbol=symbol;var isSymbol=function isSymbol(x){return x&&Symbol.type===x.type};exports.isSymbol=isSymbol;var isKeyword=function isKeyword(x){return isString(x)&&count(x)>1&&first(x)==="꞉"};exports.isKeyword=isKeyword;var keyword=function keyword(ns,id){return isKeyword(ns)?ns:isSymbol(ns)?""+"꞉"+name(ns):isNil(id)?""+"꞉"+ns:isNil(ns)?""+"꞉"+id:"else"?""+"꞉"+ns+__nsSeparator__+id:void 0};exports.keyword=keyword;var keywordName=function keywordName(value){return last(split(subs(value,1),__nsSeparator__))};var name=function name(value){return isSymbol(value)?value.name:isKeyword(value)?keywordName(value):isString(value)?value:"else"?function(){throw new TypeError(""+"Doesn't support name: "+value)}():void 0};exports.name=name;var keywordNamespace=function keywordNamespace(x){var parts=split(subs(x,1),__nsSeparator__);return count(parts)>1?(parts||0)[0]:void 0};var namespace=function namespace(x){return isSymbol(x)?x.namespace:isKeyword(x)?keywordNamespace(x):"else"?function(){throw new TypeError(""+"Doesn't supports namespace: "+x)}():void 0};exports.namespace=namespace;var gensym=function gensym(prefix){return symbol(""+(isNil(prefix)?"G__":prefix)+(gensym.base=gensym.base+1))};exports.gensym=gensym;gensym.base=0;var isUnquote=function isUnquote(form){return isList(form)&&isEqual(first(form),symbol(void 0,"unquote"))};exports.isUnquote=isUnquote;var isUnquoteSplicing=function isUnquoteSplicing(form){return isList(form)&&isEqual(first(form),symbol(void 0,"unquote-splicing"))};exports.isUnquoteSplicing=isUnquoteSplicing;var isQuote=function isQuote(form){return isList(form)&&isEqual(first(form),symbol(void 0,"quote"))};exports.isQuote=isQuote;var isSyntaxQuote=function isSyntaxQuote(form){return isList(form)&&isEqual(first(form),symbol(void 0,"syntax-quote"))};exports.isSyntaxQuote=isSyntaxQuote;var normalize=function normalize(n,len){return function loop(ns){var recur=loop;while(recur===loop){recur=count(ns)<len?(ns=""+"0"+ns,loop):ns}return recur}(""+n)};var quoteString=function quoteString(s){s=join('\\"',split(s,'"'));s=join("\\\\",split(s,"\\"));s=join("\\b",split(s,"\b"));s=join("\\f",split(s,"\f"));s=join("\\n",split(s,"\n"));s=join("\\r",split(s,"\r"));s=join("\\t",split(s,"	"));return""+'"'+s+'"'};exports.quoteString=quoteString;var prStr=function prStr(x){return isNil(x)?"nil":isKeyword(x)?namespace(x)?""+":"+namespace(x)+"/"+name(x):""+":"+name(x):isString(x)?quoteString(x):isDate(x)?""+'#inst "'+x.getUTCFullYear()+"-"+normalize(inc(x.getUTCMonth()),2)+"-"+normalize(x.getUTCDate(),2)+"T"+normalize(x.getUTCHours(),2)+":"+normalize(x.getUTCMinutes(),2)+":"+normalize(x.getUTCSeconds(),2)+"."+normalize(x.getUTCMilliseconds(),3)+"-"+'00:00"':isVector(x)?""+"["+join(" ",map(prStr,vec(x)))+"]":isDictionary(x)?""+"{"+join(", ",map(function(pair){return""+prStr(first(pair))+" "+prStr(second(pair))},x))+"}":isSequential(x)?""+"("+join(" ",map(prStr,vec(x)))+")":isRePattern(x)?""+'#"'+join("\\/",split(x.source,"/"))+'"':"else"?""+x:void 0};exports.prStr=prStr},{"./sequence":3,"./string":7,"./runtime":2}],7:[function(require,module,exports){var _ns_={id:"wisp.string"};var wisp_runtime=require("./runtime");var str=wisp_runtime.str;var subs=wisp_runtime.subs;var reMatches=wisp_runtime.reMatches;var isNil=wisp_runtime.isNil;var isString=wisp_runtime.isString;var wisp_sequence=require("./sequence");var vec=wisp_sequence.vec;var isEmpty=wisp_sequence.isEmpty;var split=function split(string,pattern,limit){return string.split(pattern,limit)};exports.split=split;var join=function join(separator,coll){switch(arguments.length){case 1:var coll=separator;return str.apply(str,vec(coll));case 2:return vec(coll).join(separator);default:(function(){throw Error("Invalid arity")})()}return void 0};exports.join=join;var upperCase=function upperCase(string){return string.toUpperCase()};exports.upperCase=upperCase;var upperCase=function upperCase(string){return string.toUpperCase()};exports.upperCase=upperCase;var lowerCase=function lowerCase(string){return string.toLowerCase()};exports.lowerCase=lowerCase;var capitalize=function capitalize(string){return count(string)<2?upperCase(string):""+upperCase(subs(s,0,1))+lowerCase(subs(s,1))};exports.capitalize=capitalize;var replace=function replace(string,match,replacement){return string.replace(match,replacement)};exports.replace=replace;var __LEFTSPACES__=/^\s\s*/;exports.__LEFTSPACES__=__LEFTSPACES__;var __RIGHTSPACES__=/\s\s*$/;exports.__RIGHTSPACES__=__RIGHTSPACES__;var __SPACES__=/^\s\s*$/;exports.__SPACES__=__SPACES__;var triml=isNil("".trimLeft)?function(string){return string.replace(__LEFTSPACES__,"")}:function triml(string){return string.trimLeft()};exports.triml=triml;var trimr=isNil("".trimRight)?function(string){return string.replace(__RIGHTSPACES__,"")}:function trimr(string){return string.trimRight()};exports.trimr=trimr;var trim=isNil("".trim)?function(string){return string.replace(__LEFTSPACES__).replace(__RIGHTSPACES__)}:function trim(string){return string.trim()};exports.trim=trim;var isBlank=function isBlank(string){return isNil(string)||isEmpty(string)||reMatches(__SPACES__,string)};exports.isBlank=isBlank},{"./runtime":2,"./sequence":3}],8:[function(require,module,exports){var _ns_={id:"wisp.backend.javascript.writer",doc:"Compiler backend for for writing JS output"};var wisp_ast=require("./../../ast");var name=wisp_ast.name;var namespace=wisp_ast.namespace;var symbol=wisp_ast.symbol;var isSymbol=wisp_ast.isSymbol;var isKeyword=wisp_ast.isKeyword;var wisp_sequence=require("./../../sequence");var list=wisp_sequence.list;var first=wisp_sequence.first;var rest=wisp_sequence.rest;var isList=wisp_sequence.isList;var vec=wisp_sequence.vec;var map=wisp_sequence.map;var count=wisp_sequence.count;var last=wisp_sequence.last;var reduce=wisp_sequence.reduce;var isEmpty=wisp_sequence.isEmpty;var wisp_runtime=require("./../../runtime");var isTrue=wisp_runtime.isTrue;var isNil=wisp_runtime.isNil;var isString=wisp_runtime.isString;var isNumber=wisp_runtime.isNumber;var isVector=wisp_runtime.isVector;var isDictionary=wisp_runtime.isDictionary;var isBoolean=wisp_runtime.isBoolean;var isRePattern=wisp_runtime.isRePattern;var reFind=wisp_runtime.reFind;var dec=wisp_runtime.dec;var subs=wisp_runtime.subs;var wisp_string=require("./../../string");var replace=wisp_string.replace;var join=wisp_string.join;var split=wisp_string.split;var upperCase=wisp_string.upperCase;var writeReference=function writeReference(form){"Translates references from clojure convention to JS:\n\n  **macros**      __macros__\n  list->vector    listToVector\n  set!            set\n  foo_bar         foo_bar\n  number?         isNumber\n  create-server   createServer";return function(){var id=name(form);id=id==="*"?"multiply":id==="/"?"divide":id==="+"?"sum":id==="-"?"subtract":id==="="?"equal?":id==="=="?"strict-equal?":id==="<="?"not-greater-than":id===">="?"not-less-than":id===">"?"greater-than":id==="<"?"less-than":"else"?id:void 0;id=join("_",split(id,"*"));id=join("-to-",split(id,"->"));id=join(split(id,"!"));id=join("$",split(id,"%"));id=join("-plus-",split(id,"+"));id=join("-and-",split(id,"&"));id=last(id)==="?"?""+"is-"+subs(id,0,dec(count(id))):id;id=reduce(function(result,key){return""+result+(!isEmpty(result)&&!isEmpty(key)?""+upperCase((key||0)[0])+subs(key,1):key)},"",split(id,"-"));return id}()};exports.writeReference=writeReference;var writeKeywordReference=function writeKeywordReference(form){return""+'"'+name(form)+'"'};exports.writeKeywordReference=writeKeywordReference;var writeKeyword=function writeKeyword(form){return""+'"'+"꞉"+name(form)+'"'};exports.writeKeyword=writeKeyword;var writeSymbol=function writeSymbol(form){return write(list(symbol(void 0,"symbol"),namespace(form),name(form)))};exports.writeSymbol=writeSymbol;var writeNil=function writeNil(form){return"void(0)"};exports.writeNil=writeNil;var writeNumber=function writeNumber(form){return form};exports.writeNumber=writeNumber;var writeBoolean=function writeBoolean(form){return isTrue(form)?"true":"false"};exports.writeBoolean=writeBoolean;var writeString=function writeString(form){form=replace(form,RegExp("\\\\","g"),"\\\\");form=replace(form,RegExp("\n","g"),"\\n");form=replace(form,RegExp("\r","g"),"\\r");form=replace(form,RegExp("	","g"),"\\t");form=replace(form,RegExp('"',"g"),'\\"');return""+'"'+form+'"'};exports.writeString=writeString;var writeTemplate=function writeTemplate(){var form=Array.prototype.slice.call(arguments,0);return function(){var indentPattern=/\n *$/;var lineBreakPatter=RegExp("\n","g");var getIndentation=function(code){return reFind(indentPattern,code)||"\n"};return function loop(code,parts,values){var recur=loop;while(recur===loop){recur=count(parts)>1?(code=""+code+first(parts)+replace(""+""+first(values),lineBreakPatter,getIndentation(first(parts))),parts=rest(parts),values=rest(values),loop):""+code+first(parts)}return recur}("",split(first(form),"~{}"),rest(form))}()};exports.writeTemplate=writeTemplate;var writeGroup=function writeGroup(){var forms=Array.prototype.slice.call(arguments,0);return join(", ",forms)};exports.writeGroup=writeGroup;var writeInvoke=function writeInvoke(callee){var params=Array.prototype.slice.call(arguments,1);return writeTemplate("~{}(~{})",callee,writeGroup.apply(writeGroup,params))};exports.writeInvoke=writeInvoke;var writeError=function writeError(message){return function(){return function(){throw Error(message)}()}};exports.writeError=writeError;var writeVector=writeError("Vectors are not supported");exports.writeVector=writeVector;var writeDictionary=writeError("Dictionaries are not supported");exports.writeDictionary=writeDictionary;var writePattern=writeError("Regular expressions are not supported");exports.writePattern=writePattern;var compileComment=function compileComment(form){return compileTemplate(list("//~{}\n",first(form)))};exports.compileComment=compileComment;var writeDef=function writeDef(form){var id=first(form);var isExport=(meta(form)||{}||0)["top"]&&!(meta(id)||{}||0)["private"];var attribute=symbol(namespace(id),""+"-"+name(id));return isExport?compileTemplate(list("var ~{};\n~{}",compile(cons(symbol(void 0,"set!"),form)),compile(list(symbol(void 0,"set!"),list(symbol(void 0,"."),symbol(void 0,"exports"),attribute),id)))):compileTemplate(list("var ~{}",compile(cons(symbol(void 0,"set!"),form))))};exports.writeDef=writeDef;var write=function write(form){return isNil(form)?writeNil(form):isSymbol(form)?writeReference(form):isKeyword(form)?writeKeywordReference(form):isString(form)?writeString(form):isNumber(form)?writeNumber(form):isBoolean(form)?writeBoolean(form):isRePattern(form)?writePattern(form):isVector(form)?writeVector(form):isDictionary(form)?writeDictionary():isList(form)?writeInvoke.apply(writeInvoke,map(write,vec(form))):"else"?writeError("Unsupported form"):void 0};exports.write=write},{"./../../ast":6,"./../../sequence":3,"./../../runtime":2,"./../../string":7}]},{},[1]);